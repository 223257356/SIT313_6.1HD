{"ast":null,"code":"import React,{useState,useEffect}from'react';import{auth,db}from'../utilities/firebase';// Make sure Firebase is set up\nimport{collection,addDoc,query,orderBy,onSnapshot}from'firebase/firestore';import'../styles/Messages.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Messaging=()=>{const[message,setMessage]=useState('');const[messages,setMessages]=useState([]);const[currentUser,setCurrentUser]=useState(null);useEffect(()=>{// Listen for authentication changes\nconst unsubscribeAuth=auth.onAuthStateChanged(user=>{setCurrentUser(user);// Set the current authenticated user\n});// Fetch messages from Firestore in real-time\nconst q=query(collection(db,'messages'),orderBy('createdAt','asc'));const unsubscribeMessages=onSnapshot(q,querySnapshot=>{let messagesList=[];querySnapshot.forEach(doc=>{messagesList.push({...doc.data(),id:doc.id});});setMessages(messagesList);});return()=>{unsubscribeAuth();// Unsubscribe from auth listener on unmount\nunsubscribeMessages();// Unsubscribe from messages listener on unmount\n};},[]);const sendMessage=async e=>{e.preventDefault();if(!currentUser){console.error('No authenticated user. Please log in to send messages.');return;}if(message.trim()==='')return;const{uid,displayName}=currentUser;try{await addDoc(collection(db,'messages'),{text:message,uid,displayName,createdAt:new Date()});setMessage('');// Clear input after sending\n}catch(error){console.error('Error sending message:',error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"messaging-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"messaging-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Secure Messaging\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Communicate with other DEV@Deakin users in real-time. Messages sent here are visible to all authenticated users.\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"messages\",children:messages.map(msg=>/*#__PURE__*/_jsxs(\"div\",{className:\"message \".concat(msg.uid===(currentUser===null||currentUser===void 0?void 0:currentUser.uid)?'sent':'received'),children:[/*#__PURE__*/_jsx(\"strong\",{children:msg.displayName}),\": \",msg.text]},msg.id))}),currentUser?/*#__PURE__*/_jsxs(\"form\",{onSubmit:sendMessage,className:\"message-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type your message\",value:message,onChange:e=>setMessage(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Send\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Please log in to send messages.\"})]});};export default Messaging;","map":{"version":3,"names":["React","useState","useEffect","auth","db","collection","addDoc","query","orderBy","onSnapshot","jsx","_jsx","jsxs","_jsxs","Messaging","message","setMessage","messages","setMessages","currentUser","setCurrentUser","unsubscribeAuth","onAuthStateChanged","user","q","unsubscribeMessages","querySnapshot","messagesList","forEach","doc","push","data","id","sendMessage","e","preventDefault","console","error","trim","uid","displayName","text","createdAt","Date","className","children","map","msg","concat","onSubmit","type","placeholder","value","onChange","target"],"sources":["/Users/jessicawong/Projects/SIT313_4.1P/devdeakin/src/components/Messages.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { auth, db } from '../utilities/firebase'; // Make sure Firebase is set up\nimport { collection, addDoc, query, orderBy, onSnapshot } from 'firebase/firestore';\nimport '../styles/Messages.css';\n\nconst Messaging = () => {\n  const [message, setMessage] = useState('');\n  const [messages, setMessages] = useState([]);\n  const [currentUser, setCurrentUser] = useState(null);\n\n  useEffect(() => {\n    // Listen for authentication changes\n    const unsubscribeAuth = auth.onAuthStateChanged((user) => {\n      setCurrentUser(user); // Set the current authenticated user\n    });\n\n    // Fetch messages from Firestore in real-time\n    const q = query(collection(db, 'messages'), orderBy('createdAt', 'asc'));\n    const unsubscribeMessages = onSnapshot(q, (querySnapshot) => {\n      let messagesList = [];\n      querySnapshot.forEach((doc) => {\n        messagesList.push({ ...doc.data(), id: doc.id });\n      });\n      setMessages(messagesList);\n    });\n\n    return () => {\n      unsubscribeAuth();  // Unsubscribe from auth listener on unmount\n      unsubscribeMessages();  // Unsubscribe from messages listener on unmount\n    };\n  }, []);\n\n  const sendMessage = async (e) => {\n    e.preventDefault();\n    if (!currentUser) {\n      console.error('No authenticated user. Please log in to send messages.');\n      return;\n    }\n    if (message.trim() === '') return;\n\n    const { uid, displayName } = currentUser;\n    try {\n      await addDoc(collection(db, 'messages'), {\n        text: message,\n        uid,\n        displayName,\n        createdAt: new Date(),\n      });\n      setMessage(''); // Clear input after sending\n    } catch (error) {\n      console.error('Error sending message:', error);\n    }\n  };\n\n  return (\n    <div className=\"messaging-container\">\n      <header className=\"messaging-header\">\n        <h2>Secure Messaging</h2>\n        <p>Communicate with other DEV@Deakin users in real-time. Messages sent here are visible to all authenticated users.</p>\n      </header>\n\n      <div className=\"messages\">\n        {messages.map((msg) => (\n          <div key={msg.id} className={`message ${msg.uid === currentUser?.uid ? 'sent' : 'received'}`}>\n            <strong>{msg.displayName}</strong>: {msg.text}\n          </div>\n        ))}\n      </div>\n\n      {currentUser ? (\n        <form onSubmit={sendMessage} className=\"message-form\">\n          <input\n            type=\"text\"\n            placeholder=\"Type your message\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n          />\n          <button type=\"submit\">Send</button>\n        </form>\n      ) : (\n        <p>Please log in to send messages.</p>\n      )}\n    </div>\n  );\n};\n\nexport default Messaging;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}